/**
 * @file jquery.ajax-combobox
 * @version 7.5.0
 * @author Yuusaku Miyazaki <toumin.m7@gmail.com>
 * @license MIT
 */
!function(a){"object"==typeof module&&"object"==typeof module.exports?a(require("jquery"),window,document):a(jQuery,window,document)}(function(a,b,c,d){a.fn.ajaxComboBox=function(b,c){var e=[];return this.each(function(){e.push(new a.ajaxComboBox(this,b,c))}),c!==d&&c.instance!==d&&c.instance?a(e):this},a.ajaxComboBox=function(a,b,c){this.option=this._setOption(b,c),this._setMessage(),this._setCssClass(),this._setProp(),this._setElem(a),this._setButtonAttrDefault(),this._setInitRecord(),this._ehButton(),this._ehComboInput(),this._ehWhole(),this._ehTextArea(),this.option.shorten_btn&&this._findUrlToShorten(this)},a.extend(a.ajaxComboBox.prototype,{_setOption:function(a,b){return b=this._setOption1st(a,b),b=this._setOption2nd(b)},_setOption1st:function(b,c){return a.extend({source:b,lang:"en",plugin_type:"combobox",init_record:!1,db_table:"tbl",field:"name",and_or:"AND",per_page:10,navi_num:5,primary_key:"id",button_img:'<svg class="octicon octicon-chevron-down" viewBox="0 0 10 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M5 11L0 6l1.5-1.5L5 8.25 8.5 4.5 10 6z"></path></svg>',bind_to:!1,navi_simple:!1,sub_info:!1,sub_as:{},show_field:"",hide_field:"",select_only:!1,tags:!1,shorten_btn:!1,shorten_src:"dist/bitly.php",shorten_min:20,shorten_reg:!1},c)},_setOption2nd:function(a){return a.search_field=a.search_field?a.search_field:a.field,a.and_or=a.and_or.toUpperCase(),a.hide_field=this._strToArray(a.hide_field),a.show_field=this._strToArray(a.show_field),a.search_field=this._strToArray(a.search_field),""===a.show_field[0]&&(a.show_field[0]="*"),a.order_by=a.order_by===d?a.search_field:a.order_by,a.order_by=this._setOrderbyOption(a.order_by,a.field),"textarea"==a.plugin_type&&(a.shorten_reg=this._setRegExpShort(a.shorten_reg,a.shorten_min)),a.tags&&(a.tags=this._setTagPattern(a)),a},_strToArray:function(a){return a.replace(/[\s　]+/g,"").split(",")},_setRegExpShort:function(a,b){if(a)return a;var c="(?:^|[\\s|　\\[(<「『（【［＜〈《]+)";return c+="(",c+="https:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-7)+",}",c+="|",c+="http:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-6)+",}",c+="|",c+="ftp:\\/\\/[^\\s|　\\])>」』）】］＞〉》]{"+(b-5)+",}",c+=")",new RegExp(c,"g")},_setTagPattern:function(a){for(var b=0;b<a.tags.length;b++)a.tags[b]=this._setTagOptions(a,b),a.tags[b].pattern=this._setRegExpTag(a.tags[b].pattern,a.tags[b].space);return a.tags},_setTagOptions:function(b,c){b.tags[c]=a.extend({space:[!0,!0],db_table:b.db_table,field:b.field,search_field:b.search_field,primary_key:b.primary_key,sub_info:b.sub_info,sub_as:b.sub_as,show_field:b.show_field,hide_field:b.hide_field},b.tags[c]);for(var e=["hide_field","show_field","search_field"],f=0;f<e.length;f++)"object"!=typeof b.tags[c][e[f]]&&(b.tags[c][e[f]]=this._strToArray(b.tags[c][e[f]]));return b.tags[c].order_by=b.tags[c].order_by===d?b.order_by:this._setOrderbyOption(b.tags[c].order_by,b.tags[c].field),b.tags[c]},_setRegExpTag:function(a,b){var c=a[0].replace(/[\s\S]*/,this._escapeForReg),d=a[1].replace(/[\s\S]*/,this._escapeForReg);return{left:a[0],right:a[1],reg_left:new RegExp(c+"((?:(?!"+c+"|"+d+")[^\\s　])*)$"),reg_right:new RegExp("^((?:(?!"+c+"|"+d+")[^\\s　])+)"),space_left:new RegExp("^"+c+"$|[\\s　]+"+c+"$"),space_right:new RegExp("^$|^[\\s　]+"),comp_right:new RegExp("^"+d)}},_escapeForReg:function(a){return"\\u"+(65536+a.charCodeAt(0)).toString(16).slice(1)},_setOrderbyOption:function(b,c){var d=[],e=[];if("object"==typeof b)for(var f=0;f<b.length;f++)e=a.trim(b[f]).split(" "),d[f]=2==e.length?e:[e[0],"ASC"];else e=a.trim(b).split(" "),d[0]=2==e.length?e:e[0].match(/^(ASC|DESC)$/i)?[c,e[0]]:[e[0],"ASC"];return d},_setMessage:function(){var a;switch(this.option.lang){case"de":a={add_btn:"Hinzufügen-Button",add_title:"Box hinzufügen",del_btn:"Löschen-Button",del_title:"Box löschen",next:"Nächsten",next_title:"Nächsten"+this.option.per_page+" (Pfeil-rechts)",prev:"Vorherigen",prev_title:"Vorherigen"+this.option.per_page+" (Pfeil-links)",first_title:"Ersten (Umschalt + Pfeil-links)",last_title:"Letzten (Umschalt + Pfeil-rechts)",get_all_btn:"alle (Pfeil-runter)",get_all_alt:"(Button)",close_btn:"Schließen (Tab)",close_alt:"(Button)",loading:"lade...",loading_alt:"(lade)",page_info:"num_page_top - num_page_end von cnt_whole",select_ng:"Achtung: Bitte wählen Sie aus der Liste aus.",select_ok:"OK : Richtig ausgewählt.",not_found:"nicht gefunden",ajax_error:"Bei der Verbindung zum Server ist ein Fehler aufgetreten. (ajax-combobox)"};break;case"en":a={add_btn:"Add button",add_title:"add a box",del_btn:"Del button",del_title:"delete a box",next:"Next",next_title:"Next"+this.option.per_page+" (Right key)",prev:"Prev",prev_title:"Prev"+this.option.per_page+" (Left key)",first_title:"First (Shift + Left key)",last_title:"Last (Shift + Right key)",get_all_btn:"Get All (Down key)",get_all_alt:"(button)",close_btn:"Close (Tab key)",close_alt:"(button)",loading:"loading...",loading_alt:"(loading)",page_info:"num_page_top - num_page_end of cnt_whole",select_ng:"Attention : Please choose from among the list.",select_ok:"OK : Correctly selected.",not_found:"not found",ajax_error:"An error occurred while connecting to server. (ajax-combobox)"};break;case"es":a={add_btn:"Agregar boton",add_title:"Agregar una opcion",del_btn:"Borrar boton",del_title:"Borrar una opcion",next:"Siguiente",next_title:"Proximas "+this.option.per_page+" (tecla derecha)",prev:"Anterior",prev_title:"Anteriores "+this.option.per_page+" (tecla izquierda)",first_title:"Primera (Shift + Left)",last_title:"Ultima (Shift + Right)",get_all_btn:"Ver todos (tecla abajo)",get_all_alt:"(boton)",close_btn:"Cerrar (tecla TAB)",close_alt:"(boton)",loading:"Cargando...",loading_alt:"(Cargando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atencion: Elija una opcion de la lista.",select_ok:"OK: Correctamente seleccionado.",not_found:"no encuentre",ajax_error:"Un error ocurrió mientras conectando al servidor. (ajax-combobox)"};break;case"pt-br":a={add_btn:"Adicionar botão",add_title:"Adicionar uma caixa",del_btn:"Apagar botão",del_title:"Apagar uma caixa",next:"Próxima",next_title:"Próxima "+this.option.per_page+" (tecla direita)",prev:"Anterior",prev_title:"Anterior "+this.option.per_page+" (tecla esquerda)",first_title:"Primeira (Shift + Left)",last_title:"Última (Shift + Right)",get_all_btn:"Ver todos (Seta para baixo)",get_all_alt:"(botão)",close_btn:"Fechar (tecla TAB)",close_alt:"(botão)",loading:"Carregando...",loading_alt:"(Carregando)",page_info:"num_page_top - num_page_end de cnt_whole",select_ng:"Atenção: Escolha uma opção da lista.",select_ok:"OK: Selecionado Corretamente.",not_found:"não encontrado",ajax_error:"Um erro aconteceu enquanto conectando a servidor. (ajax-combobox)"};break;default:a={add_btn:"追加ボタン",add_title:"入力ボックスを追加します",del_btn:"削除ボタン",del_title:"入力ボックスを削除します",next:"次へ",next_title:"次の"+this.option.per_page+"件 (右キー)",prev:"前へ",prev_title:"前の"+this.option.per_page+"件 (左キー)",first_title:"最初のページへ (Shift + 左キー)",last_title:"最後のページへ (Shift + 右キー)",get_all_btn:"全件取得 (下キー)",get_all_alt:"画像:ボタン",close_btn:"閉じる (Tabキー)",close_alt:"画像:ボタン",loading:"読み込み中...",loading_alt:"画像:読み込み中...",page_info:"num_page_top - num_page_end 件 (全 cnt_whole 件)",select_ng:"注意 : リストの中から選択してください",select_ok:"OK : 正しく選択されました。",not_found:"(0 件)",ajax_error:"サーバとの通信でエラーが発生しました。(ajax-combobox)"}}this.message=a},_setCssClass:function(){var b={container:"ac_container",container_open:"ac_container_open",selected:"ac_selected",re_area:"ac_result_area",navi:"ac_navi",results:"ac_results",re_off:"ac_results_off",select:"ac_over",sub_info:"ac_subinfo",select_ok:"ac_select_ok",select_ng:"ac_select_ng",input_off:"ac_input_off"};switch(this.option.plugin_type){case"combobox":b=a.extend(b,{button:"ac_button",btn_on:"ac_btn_on",btn_out:"ac_btn_out",input:"ac_input"});break;case"simple":b=a.extend(b,{input:"ac_s_input"});break;case"textarea":b=a.extend(b,{input:"ac_textarea",btn_short_off:"ac_btn_short_off"})}this.css_class=b},_setProp:function(){this.prop={timer_valchange:!1,is_suggest:!1,page_all:1,page_suggest:1,max_all:1,max_suggest:1,is_paging:!1,is_loading:!1,reserve_btn:!1,reserve_click:!1,xhr:!1,key_paging:!1,key_select:!1,prev_value:"",size_navi:null,size_results:null,size_li:null,size_left:null,tag:null}},_setElem:function(b){var c={};if(c.combo_input=a(b).attr("autocomplete","off").addClass(this.css_class.input).wrap("<div>"),c.container=a(c.combo_input).parent().addClass(this.css_class.container),"combobox"==this.option.plugin_type?(c.button=a("<div>").addClass(this.css_class.button),c.img=this.option.button_img.match(/^</)?a(this.option.button_img):a("<img>").attr("src",this.option.button_img),console.log(this.option.button_img),console.log(this.option.button_img.match(/^</)),console.log(c.img)):(c.button=!1,c.img=!1),c.result_area=a("<div>").addClass(this.css_class.re_area),c.navi=a("<div>").addClass(this.css_class.navi),c.navi_info=a("<div>").addClass("info"),c.navi_p=a("<p>"),c.results=a("<ul>").addClass(this.css_class.results),c.sub_info=a("<div>").addClass(this.css_class.sub_info),"textarea"==this.option.plugin_type)c.hidden=!1;else{var e=a(c.combo_input).attr("name")!==d?a(c.combo_input).attr("name"):a(c.combo_input).attr("id");e.match(/\]$/)?e=e.replace(/\]?$/,"_primary_key]"):e+="_primary_key",c.hidden=a('<input type="hidden" />').attr({name:e,id:e}).val("")}switch(this.option.plugin_type){case"combobox":a(c.container).append(c.button).append(c.result_area).append(c.hidden),a(c.button).append(c.img);break;case"simple":a(c.container).append(c.result_area).append(c.hidden);break;case"textarea":a(c.container).append(c.result_area)}a(c.result_area).append(c.navi).append(c.results).append(c.sub_info),a(c.navi).append(c.navi_info).append(c.navi_p),"combobox"==this.option.plugin_type?a(c.container).width(a(c.combo_input).outerWidth()+a(c.button).outerWidth()):a(c.container).width(a(c.combo_input).outerWidth()),this.elem=c},_setButtonAttrDefault:function(){this.option.select_only&&(""!==a(this.elem.combo_input).val()?"textarea"!=this.option.plugin_type&&(""!==a(this.elem.hidden).val()?a(this.elem.combo_input).attr("title",this.message.select_ok).removeClass(this.css_class.select_ng).addClass(this.css_class.select_ok):a(this.elem.combo_input).attr("title",this.message.select_ng).removeClass(this.css_class.select_ok).addClass(this.css_class.select_ng)):("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(""),a(this.elem.combo_input).removeAttr("title").removeClass(this.css_class.select_ng))),"combobox"==this.option.plugin_type&&a(this.elem.button).attr("title",this.message.get_all_btn)},_setInitRecord:function(){if(!1!==this.option.init_record)if("textarea"!=this.option.plugin_type&&a(this.elem.hidden).val(this.option.init_record),"object"==typeof this.option.source){for(var b,c=0;c<this.option.source.length;c++)if(this.option.source[c][this.option.primary_key]==this.option.init_record){b=this.option.source[c];break}this._afterInit(this,b)}else{var d=this;a.ajax({dataType:"json",url:d.option.source,data:{db_table:this.option.db_table,pkey_name:this.option.primary_key,pkey_val:this.option.init_record},success:function(a){d._afterInit(d,a)},error:function(a,b,c){d._ajaxErrorNotify(d,c)}})}},_afterInit:function(b,c){a(b.elem.combo_input).val(c[b.option.field]),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c[b.option.primary_key]),b.prop.prev_value=c[b.option.field],b.option.select_only&&a(b.elem.combo_input).attr("title",b.message.select_ok).removeClass(b.css_class.select_ng).addClass(b.css_class.select_ok)},_ehButton:function(){if("combobox"==this.option.plugin_type){var b=this;a(b.elem.button).mouseup(function(c){a(b.elem.result_area).is(":hidden")?(clearInterval(b.prop.timer_valchange),b.prop.is_suggest=!1,b._suggest(b),a(b.elem.combo_input).focus()):b._hideResults(b),c.stopPropagation()}).mouseover(function(){a(b.elem.button).addClass(b.css_class.btn_on).removeClass(b.css_class.btn_out)}).mouseout(function(){a(b.elem.button).addClass(b.css_class.btn_out).removeClass(b.css_class.btn_on)}).mouseout()}},_ehComboInput:function(){var b=this;a(b.elem.combo_input).keydown(function(a){b._processKey(b,a)}),a(b.elem.combo_input).focus(function(){b._setTimerCheckValue(b)}).click(function(){b._setCssFocusedInput(b),a(b.elem.results).children("li").removeClass(b.css_class.select)})},_ehWhole:function(){var b=this,c=!1;a(b.elem.container).mousedown(function(){c=!0}),a("html").mousedown(function(){c?c=!1:b._hideResults(b)})},_ehResults:function(){var b=this;a(b.elem.results).children("li").mouseover(function(){if(b.prop.key_select)return void(b.prop.key_select=!1);b._setSubInfo(b,this),a(b.elem.results).children("li").removeClass(b.css_class.select),a(this).addClass(b.css_class.select),b._setCssFocusedResults(b)}).click(function(a){if(b.prop.key_select)return void(b.prop.key_select=!1);a.preventDefault(),a.stopPropagation(),b._selectCurrentLine(b,!1)})},_ehNaviPaging:function(b){a(b.elem.navi).find(".navi_first").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._firstPage(b)}),a(b.elem.navi).find(".navi_prev").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._prevPage(b)}),a(b.elem.navi).find(".navi_page").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b.prop.is_suggest?b.prop.page_suggest=parseInt(a(this).text(),10):b.prop.page_all=parseInt(a(this).text(),10),b.prop.is_paging=!0,b._suggest(b)}),a(b.elem.navi).find(".navi_next").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._nextPage(b)}),a(b.elem.navi).find(".navi_last").mouseup(function(c){a(b.elem.combo_input).focus(),c.preventDefault(),b._lastPage(b)})},_ehTextArea:function(){var b=this;b.option.shorten_btn&&a(b.option.shorten_btn).click(function(){b._getShortURL(b)})},_getShortURL:function(b){a(b.elem.combo_input).attr("disabled","disabled");for(var c=a(b.elem.combo_input).val(),d=[],e=null;null!==(e=b.option.shorten_reg.exec(c));)d[d.length]=e[1];if(d.length<1)return void a(b.elem.combo_input).removeAttr("disabled");for(var f={},g=0;g<d.length;g++)f["p_"+g]=d[g];a.ajax({dataType:"json",url:b.option.shorten_src,data:f,success:function(d){var e=0,f=c.replace(b.option.shorten_reg,function(){var a=arguments[0].replace(arguments[1],d[e]);return e++,a});a(b.elem.combo_input).val(f),b.prop.prev_value=f,b._disableButtonShort(b)},error:function(a,c,d){b._ajaxErrorNotify(b,d)},complete:function(){a(b.elem.combo_input).removeAttr("disabled").focus()}})},_ajaxErrorNotify:function(a,b){alert(a.message.ajax_error)},_scrollWindow:function(c,d){var e,f=c._getCurrentLine(c),g=f&&!d?f.offset().top:a(c.elem.container).offset().top;if(c.option.sub_info){var h=a(c.elem.sub_info).children("dl:visible");e=a(h).height()+parseInt(a(h).css("border-top-width"))+parseInt(a(h).css("border-bottom-width"))}else c.prop.size_li=a(c.elem.results).children("li:first").outerHeight(),e=c.prop.size_li;var i,j=a(b).height(),k=a(b).scrollTop(),l=k+j-e;if(a(f).length)if(g<k||e>j)i=g-k;else{if(!(g>l))return;i=g-l}else g<k&&(i=g-k);b.scrollBy(0,i)},_setCssFocusedInput:function(b){a(b.elem.results).addClass(b.css_class.re_off),a(b.elem.combo_input).removeClass(b.css_class.input_off),a(b.elem.sub_info).children("dl").hide()},_setCssFocusedResults:function(b){a(b.elem.results).removeClass(b.css_class.re_off),a(b.elem.combo_input).addClass(b.css_class.input_off)},_enableButtonShort:function(b){a(b.option.shorten_btn).removeClass(b.css_class.btn_short_off).removeAttr("disabled")},_disableButtonShort:function(b){a(b.option.shorten_btn).addClass(b.css_class.btn_short_off).attr("disabled","disabled")},_setTimerCheckValue:function(a){a.prop.timer_valchange=setTimeout(function(){a._checkValue(a)},500)},_checkValue:function(b){var c=a(b.elem.combo_input).val();if(c!=b.prop.prev_value)if(b.prop.prev_value=c,"textarea"==b.option.plugin_type){b._findUrlToShorten(b);var d=b._findTag(b,c);d&&(b._setTextAreaNewSearch(b,d),b._suggest(b))}else a(b.elem.combo_input).removeAttr("sub_info"),"textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(""),b.option.select_only&&b._setButtonAttrDefault(),b.prop.page_suggest=1,b.prop.is_suggest=!0,b._suggest(b);else if("textarea"==b.option.plugin_type&&a(b.elem.result_area).is(":visible")){var e=b._findTag(b,c);e?e.str==b.prop.tag.str&&e.pos_left==b.prop.tag.pos_left||(b._setTextAreaNewSearch(b,e),b._suggest(b)):b._hideResults(b)}b._setTimerCheckValue(b)},_setTextAreaNewSearch:function(a,b){a.prop.tag=b,a.prop.page_suggest=1,a.option.search_field=a.option.tags[a.prop.tag.type].search_field,a.option.order_by=a.option.tags[a.prop.tag.type].order_by,a.option.primary_key=a.option.tags[a.prop.tag.type].primary_key,a.option.db_table=a.option.tags[a.prop.tag.type].db_table,a.option.field=a.option.tags[a.prop.tag.type].field,a.option.sub_info=a.option.tags[a.prop.tag.type].sub_info,a.option.sub_as=a.option.tags[a.prop.tag.type].sub_as,a.option.show_field=a.option.tags[a.prop.tag.type].show_field,a.option.hide_field=a.option.tags[a.prop.tag.type].hide_field},_findUrlToShorten:function(b){for(var c=null;null!==b.option.shorten_reg.exec(a(b.elem.combo_input).val());){c=!0,b.option.shorten_reg.lastIndex=0;break}c?b._enableButtonShort(b):b._disableButtonShort(b)},_findTag:function(b,c){for(var d,e,f,g,h,i=b._getCaretPosition(a(b.elem.combo_input).get(0)),j=0;j<b.option.tags.length;j++)if(d=c.substring(0,i),d=d.match(b.option.tags[j].pattern.reg_left))return d=d[1],e=i-d.length,e<0&&(e=0),f=c.substring(i,c.length),f=f.match(b.option.tags[j].pattern.reg_right),f?(f=f[1],g=i+f.length):(f="",g=i),h=d+""+f,b.prop.is_suggest=""!==h,{type:j,str:h,pos_left:e,pos_right:g};return!1},_getCaretPosition:function(a){var b=0;if(c.selection){a.focus();var d=c.selection.createRange();d.moveStart("character",-a.value.length),b=d.text.length}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},_setCaretPosition:function(b,c){var d=a(b.elem.combo_input).get(0);if(d.setSelectionRange)d.focus(),d.setSelectionRange(c,c);else if(d.createTextRange){var e=d.createTextRange();e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",c),e.select()}},_processKey:function(b,c){if(a.inArray(c.keyCode,[27,38,40,9])>-1&&a(b.elem.result_area).is(":visible")||a.inArray(c.keyCode,[37,39,13,9])>-1&&b._getCurrentLine(b)||40==c.keyCode&&"textarea"!=b.option.plugin_type)switch(c.preventDefault(),c.stopPropagation(),c.cancelBubble=!0,c.returnValue=!1,c.keyCode){case 37:c.shiftKey?b._firstPage(b):b._prevPage(b);break;case 38:b.prop.key_select=!0,b._prevLine(b);break;case 39:c.shiftKey?b._lastPage(b):b._nextPage(b);break;case 40:a(b.elem.results).children("li").length?(b.prop.key_select=!0,b._nextLine(b)):(b.prop.is_suggest=!1,b._suggest(b));break;case 9:b.prop.key_paging=!0,b._hideResults(b);break;case 13:b._selectCurrentLine(b,!0);break;case 27:b.prop.key_paging=!0,b._hideResults(b)}else 16!=c.keyCode&&b._setCssFocusedInput(b),b._checkValue(b)},_abortAjax:function(a){a.prop.xhr&&(a.prop.xhr.abort(),a.prop.xhr=!1)},_suggest:function(b){var c;if("textarea"!=b.option.plugin_type){if(c=b.prop.is_suggest?a.trim(a(b.elem.combo_input).val()):"",c.length<1&&b.prop.is_suggest)return void b._hideResults(b);c=c.split(/[\s　]+/)}else c=[b.prop.tag.str];if(b._abortAjax(b),b._setLoading(b),a(b.elem.sub_info).children("dl").hide(),b.prop.is_paging){var d=b._getCurrentLine(b);b.prop.is_paging=d?a(b.elem.results).children("li").index(d):-1}else b.prop.is_suggest||(b.prop.is_paging=0);var e=b.prop.is_suggest?b.prop.page_suggest:b.prop.page_all;"object"==typeof b.option.source?b._searchForJson(b,c,e):b._searchForDb(b,c,e)},_setLoading:function(b){a(b.elem.navi_info).text(b.message.loading),""===a(b.elem.results).html()&&(a(b.elem.navi).children("p").empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open))},_searchForDb:function(b,c,d){b.prop.xhr=a.ajax({dataType:"json",url:b.option.source,data:{q_word:c,page_num:d,per_page:b.option.per_page,search_field:b.option.search_field,and_or:b.option.and_or,order_by:b.option.order_by,db_table:b.option.db_table},success:function(e){if(e.candidate=[],e.primary_key=[],e.subinfo=[],"object"!=typeof e.result)return b.prop.xhr=null,void b._notFoundSearch(b);for(e.cnt_page=e.result.length,i=0;i<e.cnt_page;i++){e.subinfo[i]=[];for(var f in e.result[i])if(f==b.option.primary_key&&e.primary_key.push(e.result[i][f]),f==b.option.field)e.candidate.push(e.result[i][f]);else if(-1==a.inArray(f,b.option.hide_field)){if(""!==b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(f,b.option.show_field))continue;e.subinfo[i][f]=e.result[i][f]}}delete e.result,b._prepareResults(b,e,c,d)},error:function(a,c,d){"abort"!=c&&(b._hideResults(b),b._ajaxErrorNotify(b,d))},complete:function(){b.prop.xhr=null}})},_searchForJson:function(b,c,e){var f=[],g=[],h=[],i={},j=0,k=[];do{g[j]=c[j].replace(/\W/g,"\\$&").toString(),k[j]=new RegExp(g[j],"gi"),j++}while(j<c.length);for(j=0;j<b.option.source.length;j++){for(var l=!1,m=0;m<k.length;m++)if(b.option.source[j][b.option.field].match(k[m])){if(l=!0,"OR"==b.option.and_or)break}else if(l=!1,"AND"==b.option.and_or)break;l&&f.push(b.option.source[j])}if(f.length===d)return void b._notFoundSearch(b);i.cnt_whole=f.length;var n=new RegExp("^"+g[0]+"$","gi"),o=new RegExp("^"+g[0],"gi"),p=[],q=[],r=[];for(j=0;j<f.length;j++)f[j][b.option.order_by[0][0]].match(n)?p.push(f[j]):f[j][b.option.order_by[0][0]].match(o)?q.push(f[j]):r.push(f[j]);b.option.order_by[0][1].match(/^asc$/i)?(p=b._sortAsc(b,p),q=b._sortAsc(b,q),r=b._sortAsc(b,r)):(p=b._sortDesc(b,p),q=b._sortDesc(b,q),r=b._sortDesc(b,r)),h=h.concat(p).concat(q).concat(r);var s=(e-1)*b.option.per_page,t=s+b.option.per_page;for(j=s,sub=0;j<t&&h[j]!==d;j++,sub++)for(var u in h[j])if(u==b.option.primary_key&&(i.primary_key===d&&(i.primary_key=[]),i.primary_key.push(h[j][u])),u==b.option.field)i.candidate===d&&(i.candidate=[]),i.candidate.push(h[j][u]);else if(-1==a.inArray(u,b.option.hide_field)){if(""!==b.option.show_field&&-1==a.inArray("*",b.option.show_field)&&-1==a.inArray(u,b.option.show_field))continue;i.subinfo===d&&(i.subinfo=[]),i.subinfo[sub]===d&&(i.subinfo[sub]=[]),i.subinfo[sub][u]=h[j][u]}i.candidate===d&&(i.candidate=[]),i.cnt_page=i.candidate.length,b._prepareResults(b,i,c,e)},_sortAsc:function(a,b){return b.sort(function(b,c){return b[a.option.order_by[0][0]].localeCompare(c[a.option.order_by[0][0]])}),b},_sortDesc:function(a,b){return b.sort(function(b,c){return c[a.option.order_by[0][0]].localeCompare(b[a.option.order_by[0][0]])}),b},_notFoundSearch:function(b){a(b.elem.navi_info).text(b.message.not_found),a(b.elem.navi_p).hide(),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._setCssFocusedInput(b)},_prepareResults:function(b,c,d,e){if(b._setNavi(b,c.cnt_whole,c.cnt_page,e),c.subinfo&&b.option.sub_info||(c.subinfo=!1),c.primary_key||(c.primary_key=!1),b.option.select_only&&1===c.candidate.length&&c.candidate[0]==d[0]&&("textarea"!=b.option.plugin_type&&a(b.elem.hidden).val(c.primary_key[0]),this._setButtonAttrDefault()),b._displayResults(b,c.candidate,c.subinfo,c.primary_key),!1===b.prop.is_paging)b._setCssFocusedInput(b);else{var f=b.prop.is_paging,g=a(b.elem.results).children("li").length-1;f>g&&(f=g);var h=a(b.elem.results).children("li").eq(f);a(h).addClass(b.css_class.select),b._setSubInfo(b,h),b.prop.is_paging=!1,b._setCssFocusedResults(b)}},_setNavi:function(b,c,d,e){var f=b.option.per_page*(e-1)+1,g=f+d-1,h=b.message.page_info.replace("cnt_whole",c).replace("num_page_top",f).replace("num_page_end",g);a(b.elem.navi_info).text(h);var i=Math.ceil(c/b.option.per_page);if(i>1){a(b.elem.navi_p).empty(),b.prop.is_suggest?b.prop.max_suggest=i:b.prop.max_all=i;for(var j=e-Math.ceil((b.option.navi_num-1)/2),k=e+Math.floor((b.option.navi_num-1)/2);j<1;)j++,k++;for(;k>i;)k--;for(;k-j<b.option.navi_num-1&&j>1;)j--;1==e?(b.option.navi_simple||a("<span>").text("<< 1").addClass("page_end").appendTo(b.elem.navi_p),a("<span>").text(b.message.prev).addClass("page_end").appendTo(b.elem.navi_p)):(b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)",class:"navi_first"}).text("<< 1").attr("title",b.message.first_title).appendTo(b.elem.navi_p),a("<a>").attr({href:"javascript:void(0)",class:"navi_prev",title:b.message.prev_title}).text(b.message.prev).appendTo(b.elem.navi_p));for(var l=j;l<=k;l++){var m=l==e?'<span class="current">'+l+"</span>":l;a("<a>").attr({href:"javascript:void(0)",class:"navi_page"}).html(m).appendTo(b.elem.navi_p)}e==i?(a("<span>").text(b.message.next).addClass("page_end").appendTo(b.elem.navi_p),b.option.navi_simple||a("<span>").text(i+" >>").addClass("page_end").appendTo(b.elem.navi_p)):(a("<a>").attr({href:"javascript:void(0)",class:"navi_next"}).text(b.message.next).attr("title",b.message.next_title).appendTo(b.elem.navi_p),b.option.navi_simple||a("<a>").attr({href:"javascript:void(0)",class:"navi_last"}).text(i+" >>").attr("title",b.message.last_title).appendTo(b.elem.navi_p)),a(b.elem.navi_p).show(),b._ehNaviPaging(b)}else a(b.elem.navi_p).hide()},_setSubInfo:function(b,c){if(b.option.sub_info){b.prop.size_results=(a(b.elem.results).outerHeight()-a(b.elem.results).height())/2,b.prop.size_navi=a(b.elem.navi).outerHeight(),b.prop.size_li=a(b.elem.results).children("li:first").outerHeight(),b.prop.size_left=a(b.elem.results).outerWidth();var d=a(b.elem.results).children("li").index(c);a(b.elem.sub_info).children("dl").hide();var e=0;"none"!=a(b.elem.navi).css("display")&&(e+=b.prop.size_navi),e+=b.prop.size_results+b.prop.size_li*d;var f=b.prop.size_left;e+="px",f+="px",a(b.elem.sub_info).children("dl").eq(d).css({position:"absolute",top:e,left:f,display:"block"})}},_displayResults:function(b,c,d,e){a(b.elem.results).empty(),a(b.elem.sub_info).empty();for(var f=0;f<c.length;f++){var g=a("<li>").text(c[f]).attr({pkey:e[f],title:c[f]});if("textarea"!=b.option.plugin_type&&e[f]==a(b.elem.hidden).val()&&a(g).addClass(b.css_class.selected),a(b.elem.results).append(g),d){var h,i,j=[],k=a("<dl>");for(var l in d[f]){var m=l.replace("'","\\'");null===d[f][l]?d[f][l]="":d[f][l]+="";var n=d[f][l].replace("'","\\'");j.push("'"+m+"':'"+n+"'"),h=b.option.sub_as[l]?b.option.sub_as[l]:l,h=a("<dt>").text(h),"simple"==b.option.sub_info&&a(h).addClass("hide"),k.append(h),i=a("<dd>").text(d[f][l]),k.append(i)}j="{"+j.join(",")+"}",a(g).attr("sub_info",j),a(b.elem.sub_info).append(k),"simple"==b.option.sub_info&&""===k.children("dd").text()&&k.addClass("ac_dl_empty")}}b._calcWidthResults(b),a(b.elem.container).addClass(b.css_class.container_open),b._ehResults(),"combobox"==b.option.plugin_type&&a(b.elem.button).attr("title",b.message.close_btn)},_calcWidthResults:function(b){var c;if(c="combobox"==b.option.plugin_type?a(b.elem.combo_input).outerWidth()+a(b.elem.button).outerWidth():a(b.elem.combo_input).outerWidth(),a(b.elem.container).width(c),"static"==a(b.elem.container).css("position")){var d=a(b.elem.combo_input).offset();a(b.elem.result_area).css({top:d.top+a(b.elem.combo_input).outerHeight()+"px",left:d.left+"px"})}else a(b.elem.result_area).css({top:a(b.elem.combo_input).outerHeight()+"px",left:"0px"});a(b.elem.result_area).width(a(b.elem.container).width()-(a(b.elem.result_area).outerWidth()-a(b.elem.result_area).innerWidth())).show()},_hideResults:function(b){b.prop.key_paging&&(b._scrollWindow(b,!0),b.prop.key_paging=!1),b._setCssFocusedInput(b),a(b.elem.results).empty(),a(b.elem.sub_info).empty(),a(b.elem.result_area).hide(),a(b.elem.container).removeClass(b.css_class.container_open),b._abortAjax(b),b._setButtonAttrDefault()},_firstPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest=1,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all=1,a.prop.is_paging=!0,a._suggest(a))},_prevPage:function(a){a.prop.is_suggest?a.prop.page_suggest>1&&(a.prop.page_suggest--,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all>1&&(a.prop.page_all--,a.prop.is_paging=!0,a._suggest(a))},_nextPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest++,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all++,a.prop.is_paging=!0,a._suggest(a))},_lastPage:function(a){a.prop.is_suggest?a.prop.page_suggest<a.prop.max_suggest&&(a.prop.page_suggest=a.prop.max_suggest,a.prop.is_paging=!0,a._suggest(a)):a.prop.page_all<a.prop.max_all&&(a.prop.page_all=a.prop.max_all,a.prop.is_paging=!0,a._suggest(a))},_selectCurrentLine:function(b,c){b._scrollWindow(b,!0);var d=b._getCurrentLine(b);if(d){if("textarea"!=b.option.plugin_type)a(b.elem.combo_input).val(a(d).text()),b.option.sub_info&&a(b.elem.combo_input).attr("sub_info",a(d).attr("sub_info")),b.option.select_only&&b._setButtonAttrDefault(),a(b.elem.hidden).val(a(d).attr("pkey"));else{var e,f,g,h,i=b.prop.prev_value.substring(0,b.prop.tag.pos_left),j=b.prop.prev_value.substring(b.prop.tag.pos_right);e=a(d).text(),b.option.tags[b.prop.tag.type].space[0]&&!i.match(b.option.tags[b.prop.tag.type].pattern.space_left)&&(f=b.option.tags[b.prop.tag.type].pattern.left.length,g=i.length,i=i.substring(0,g-f)+" "+i.substring(g-f)),j.match(b.option.tags[b.prop.tag.type].pattern.comp_right)||(j=b.option.tags[b.prop.tag.type].pattern.right+j),b.option.tags[b.prop.tag.type].space[1]&&!j.match(b.option.tags[b.prop.tag.type].pattern.space_right)&&(f=b.option.tags[b.prop.tag.type].pattern.right.length,j=j.substring(0,f)+" "+j.substring(f)),a(b.elem.combo_input).val(i+""+e+j),h=i.length+e.length,b._setCaretPosition(b,h)}b.prop.prev_value=a(b.elem.combo_input).val(),b._hideResults(b)}b.option.bind_to&&a(b.elem.combo_input).trigger(b.option.bind_to,c),a(b.elem.combo_input).focus(),a(b.elem.combo_input).change(),b._setCssFocusedInput(b)},_getCurrentLine:function(b){if(a(b.elem.result_area).is(":hidden"))return!1;var c=a(b.elem.results).children("li."+b.css_class.select);return!!a(c).length&&c},_nextLine:function(b){var c,d=b._getCurrentLine(b);if(d?(c=a(b.elem.results).children("li").index(d),a(d).removeClass(b.css_class.select)):c=-1,++c<a(b.elem.results).children("li").length){var e=a(b.elem.results).children("li").eq(c);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)},_prevLine:function(b){var c,d=b._getCurrentLine(b);if(d?(c=a(b.elem.results).children("li").index(d),a(d).removeClass(b.css_class.select)):c=a(b.elem.results).children("li").length,--c>-1){var e=a(b.elem.results).children("li").eq(c);b._setSubInfo(b,e),a(e).addClass(b.css_class.select),b._setCssFocusedResults(b)}else b._setCssFocusedInput(b);b._scrollWindow(b,!1)}})});